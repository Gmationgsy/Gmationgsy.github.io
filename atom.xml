<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-08-24T15:41:41.173Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Security 结合 oauth2的基本使用方法（三）</title>
    <link href="http://example.com/2021/08/15/aouth2-pass-refresh_token/"/>
    <id>http://example.com/2021/08/15/aouth2-pass-refresh_token/</id>
    <published>2021-08-15T05:29:03.721Z</published>
    <updated>2021-08-24T15:41:41.173Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前一章-我们介绍了密码模式的登录形式-：接下来我们介绍一下-refresh-token问题"><a href="#1-前一章-我们介绍了密码模式的登录形式-：接下来我们介绍一下-refresh-token问题" class="headerlink" title="1.前一章 我们介绍了密码模式的登录形式 ：接下来我们介绍一下 refresh_token问题"></a>1.前一章 我们介绍了密码模式的登录形式 ：接下来我们介绍一下 refresh_token问题</h2><h3 id="如果要支持-refresh-token"><a href="#如果要支持-refresh-token" class="headerlink" title="如果要支持 refresh_token"></a>如果要支持 refresh_token</h3><ol><li><h4 id="AuthorizationServer-类中配置-配置-tokenStore-的实列"><a href="#AuthorizationServer-类中配置-配置-tokenStore-的实列" class="headerlink" title="AuthorizationServer 类中配置   配置 tokenStore 的实列"></a>AuthorizationServer 类中配置   配置 tokenStore 的实列</h4></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function">TokenStore <span class="title">tokenStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> InMemoryTokenStore();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><h4 id="注入-ClientDetailsService"><a href="#注入-ClientDetailsService" class="headerlink" title="注入 ClientDetailsService"></a>注入 ClientDetailsService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   ClientDetailsService clientDetailsService;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><h4 id="配置-tokenServices-实例"><a href="#配置-tokenServices-实例" class="headerlink" title="配置 tokenServices 实例"></a>配置 tokenServices 实例</h4></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function">AuthorizationServerTokenServices <span class="title">tokenServices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       DefaultTokenServices services = <span class="keyword">new</span> DefaultTokenServices();</span><br><span class="line">       <span class="comment">//注入客户端</span></span><br><span class="line">       services.setClientDetailsService(clientDetailsService);</span><br><span class="line">       <span class="comment">//支持token刷新</span></span><br><span class="line">       services.setSupportRefreshToken(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//注入 tokenStore</span></span><br><span class="line">       services.setTokenStore(tokenStore);</span><br><span class="line">       <span class="keyword">return</span> services;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><h4 id="注入-tokenServices"><a href="#注入-tokenServices" class="headerlink" title="注入 tokenServices"></a>注入 tokenServices</h4></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用密码模式需要配置  </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">       endpoints</span><br><span class="line">               .authenticationManager(authenticationManager)</span><br><span class="line">               .tokenServices(tokenServices());  <span class="comment">//注入 tokenServices实例</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id><a href="#" class="headerlink" title></a></h3><h3 id="修改-后的-AuthorizationServer-的整个-代码为"><a href="#修改-后的-AuthorizationServer-的整个-代码为" class="headerlink" title="修改 后的  AuthorizationServer  的整个 代码为"></a>修改 后的  AuthorizationServer  的整个 代码为</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码加密的类  springSecurity提供</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TokenStore <span class="title">tokenStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryTokenStore();   <span class="comment">//选择基于内存的方式</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ClientDetailsService clientDetailsService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">AuthorizationServerTokenServices <span class="title">tokenServices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultTokenServices services = <span class="keyword">new</span> DefaultTokenServices();</span><br><span class="line">        <span class="comment">//注入客户端</span></span><br><span class="line">        services.setClientDetailsService(clientDetailsService);</span><br><span class="line">        <span class="comment">//支持token刷新</span></span><br><span class="line">        services.setSupportRefreshToken(<span class="keyword">true</span>);</span><br><span class="line">         <span class="comment">//注入 tokenStore</span></span><br><span class="line">        services.setTokenStore(tokenStore);</span><br><span class="line">        <span class="keyword">return</span> services;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用密码模式需要配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">        endpoints</span><br><span class="line">                .authenticationManager(authenticationManager)</span><br><span class="line">                .tokenServices(tokenServices());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        clients.inMemory()</span><br><span class="line">                .withClient(<span class="string">&quot;gsy&quot;</span>)<span class="comment">//配置client_id</span></span><br><span class="line">                .secret(passwordEncoder.encode(<span class="string">&quot;gsy123456&quot;</span>))<span class="comment">//配置client_secret</span></span><br><span class="line">                .accessTokenValiditySeconds(<span class="number">7200</span>)<span class="comment">//配置访问token的有效期</span></span><br><span class="line">                .refreshTokenValiditySeconds(<span class="number">25600</span>)<span class="comment">//配置刷新token的有效期</span></span><br><span class="line">                .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">                .scopes(<span class="string">&quot;all&quot;</span>)<span class="comment">//配置申请的权限范围</span></span><br><span class="line">                .autoApprove(<span class="keyword">true</span>)  <span class="comment">//自动批准</span></span><br><span class="line">                <span class="comment">//authorization_code 授权码模式   //password 密码模式   //refresh_token 刷新token</span></span><br><span class="line">                .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;refresh_token&quot;</span>);<span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="至此-，该工程将支持-refresh-token-模式-刷新token-之后-，原有的token-会将失效"><a href="#至此-，该工程将支持-refresh-token-模式-刷新token-之后-，原有的token-会将失效" class="headerlink" title="至此 ，该工程将支持  refresh_token 模式, 刷新token 之后 ，原有的token 会将失效"></a>至此 ，该工程将支持  refresh_token 模式, 刷新token 之后 ，原有的token 会将失效</h3><p><img src="/2021/08/15/aouth2-pass-refresh_token/img_20210824232200.png"></p><p>首先 获取  refresh_token  的值，然后将值带入 如下</p><p><img src="/2021/08/15/aouth2-pass-refresh_token/img_20210824232232.png"></p><p>可以看见  获取到 新的  access_token  ，至此完成 刷新token的操作 ，开始访问 ，可以看见 访问结果 使用 Authorization 模式访问 </p><p><img src="/2021/08/15/aouth2-pass-refresh_token/img_20210824232558.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前一章-我们介绍了密码模式的登录形式-：接下来我们介绍一下-refresh-token问题&quot;&gt;&lt;a href=&quot;#1-前一章-我们介绍了密码模式的登录形式-：接下来我们介绍一下-refresh-token问题&quot; class=&quot;headerlink&quot; title</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring Security 结合 oauth2的基本使用方法（二）</title>
    <link href="http://example.com/2021/06/01/aouth2-pass/"/>
    <id>http://example.com/2021/06/01/aouth2-pass/</id>
    <published>2021-06-01T13:44:33.396Z</published>
    <updated>2021-06-01T13:52:43.096Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前一章中我门介绍了-oauth2-的授权的码的登录模式，现在我们来介绍一下-（密码模式）"><a href="#1-前一章中我门介绍了-oauth2-的授权的码的登录模式，现在我们来介绍一下-（密码模式）" class="headerlink" title="1.前一章中我门介绍了 oauth2 的授权的码的登录模式，现在我们来介绍一下         （密码模式）"></a>1.前一章中我门介绍了 oauth2 的授权的码的登录模式，现在我们来介绍一下         （密码模式）</h2><h3 id="我会在前一篇文章所搭建的基础上做出修改"><a href="#我会在前一篇文章所搭建的基础上做出修改" class="headerlink" title="我会在前一篇文章所搭建的基础上做出修改"></a>我会在前一篇文章所搭建的基础上做出修改</h3><h3 id="1-在授权服务器（AuthorizationServer）加上-authorizedGrantTypes后面配置上-password模式即可"><a href="#1-在授权服务器（AuthorizationServer）加上-authorizedGrantTypes后面配置上-password模式即可" class="headerlink" title="1.在授权服务器（AuthorizationServer）加上   authorizedGrantTypes后面配置上   password模式即可"></a>1.在授权服务器（AuthorizationServer）加上   authorizedGrantTypes后面配置上   password模式即可</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> AuthenticationManager authenticationManager;   <span class="comment">// 提前需要在 securityconfig里面注入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">      endpoints.authenticationManager(authenticationManager);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      clients.inMemory()</span><br><span class="line">              .withClient(<span class="string">&quot;gsy&quot;</span>)<span class="comment">//配置client_id</span></span><br><span class="line">              .secret(passwordEncoder.encode(<span class="string">&quot;gsy123456&quot;</span>))<span class="comment">//配置client_secret</span></span><br><span class="line">              .accessTokenValiditySeconds(<span class="number">7200</span>)<span class="comment">//配置访问token的有效期</span></span><br><span class="line">              .refreshTokenValiditySeconds(<span class="number">25600</span>)<span class="comment">//配置刷新token的有效期</span></span><br><span class="line">              .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">              .scopes(<span class="string">&quot;all&quot;</span>)<span class="comment">//配置申请的权限范围</span></span><br><span class="line">              .autoApprove(<span class="keyword">true</span>)  <span class="comment">//自动批准</span></span><br><span class="line">              .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>);<span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br></pre></td></tr></table></figure><h3 id="2-WebSecurityConfig配置中添加-AuthenticationManager-的实例"><a href="#2-WebSecurityConfig配置中添加-AuthenticationManager-的实例" class="headerlink" title="2.WebSecurityConfig配置中添加 AuthenticationManager 的实例"></a>2.WebSecurityConfig配置中添加 AuthenticationManager 的实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="此时-将同时支持授权码模式和密码模式；"><a href="#此时-将同时支持授权码模式和密码模式；" class="headerlink" title="此时 将同时支持授权码模式和密码模式；"></a>此时 将同时支持授权码模式和密码模式；</h3><h3 id="授权码模式和密码模式-的区别在于-：密码模式需要获取授权码，通过密码登录-直接获取token-，密码模式-用的你的-登录密码（WebSecurityConfig配置的密码），不是你的认证密码；"><a href="#授权码模式和密码模式-的区别在于-：密码模式需要获取授权码，通过密码登录-直接获取token-，密码模式-用的你的-登录密码（WebSecurityConfig配置的密码），不是你的认证密码；" class="headerlink" title="授权码模式和密码模式 的区别在于 ：密码模式需要获取授权码，通过密码登录 直接获取token   ，密码模式 用的你的 登录密码（WebSecurityConfig配置的密码），不是你的认证密码；"></a>授权码模式和密码模式 的区别在于 ：密码模式需要获取授权码，通过密码登录 直接获取token   ，密码模式 用的你的 登录密码（WebSecurityConfig配置的密码），不是你的认证密码；</h3><p>需要修改的两个类整个代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        clients.inMemory()</span><br><span class="line">                .withClient(<span class="string">&quot;gsy&quot;</span>)<span class="comment">//配置client_id</span></span><br><span class="line">                .secret(passwordEncoder.encode(<span class="string">&quot;gsy123456&quot;</span>))<span class="comment">//配置client_secret</span></span><br><span class="line">                .accessTokenValiditySeconds(<span class="number">7200</span>)<span class="comment">//配置访问token的有效期</span></span><br><span class="line">                .refreshTokenValiditySeconds(<span class="number">25600</span>)<span class="comment">//配置刷新token的有效期</span></span><br><span class="line">                .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">                .scopes(<span class="string">&quot;all&quot;</span>)<span class="comment">//配置申请的权限范围</span></span><br><span class="line">                .autoApprove(<span class="keyword">true</span>)  <span class="comment">//自动批准</span></span><br><span class="line">                .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>);<span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用密码模式需要配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">        endpoints.authenticationManager(authenticationManager);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf()</span><br><span class="line">                .disable()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .permitAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                .password( <span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>))</span><br><span class="line">                .roles(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">&quot;guo&quot;</span>)</span><br><span class="line">                .password( <span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>))</span><br><span class="line">                .roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="资源服务器不变"><a href="#资源服务器不变" class="headerlink" title="资源服务器不变"></a>资源服务器不变</h3><h2 id="测试-：案例"><a href="#测试-：案例" class="headerlink" title="测试 ：案例"></a>测试 ：案例</h2><p><img src="/2021/06/01/aouth2-pass/img_20210601213142.png"></p><p><img src="/2021/06/01/aouth2-pass/img_20210601213220.png"></p><h3 id="可以看见-access-token-的获取，后续拿着-access-token-去过去资源操作是一样的。"><a href="#可以看见-access-token-的获取，后续拿着-access-token-去过去资源操作是一样的。" class="headerlink" title="可以看见 access_token 的获取，后续拿着 access_token 去过去资源操作是一样的。"></a>可以看见 access_token 的获取，后续拿着 access_token 去过去资源操作是一样的。</h3><h2 id="备注-：如何在获取access-token同时获取-refresh-token"><a href="#备注-：如何在获取access-token同时获取-refresh-token" class="headerlink" title="备注 ：如何在获取access_token同时获取 refresh_token"></a>备注 ：如何在获取access_token同时获取 refresh_token</h2><h3 id="只需要在-AuthorizationServer授权服务器中添加-authorizedGrantTypes-添加-refresh-token-，其他不变"><a href="#只需要在-AuthorizationServer授权服务器中添加-authorizedGrantTypes-添加-refresh-token-，其他不变" class="headerlink" title="只需要在 AuthorizationServer授权服务器中添加  authorizedGrantTypes 添加 refresh_token  ，其他不变"></a>只需要在 AuthorizationServer授权服务器中添加  authorizedGrantTypes 添加 refresh_token  ，其他不变</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      clients.inMemory()</span><br><span class="line">              .withClient(<span class="string">&quot;gsy&quot;</span>)<span class="comment">//配置client_id</span></span><br><span class="line">              .secret(passwordEncoder.encode(<span class="string">&quot;gsy123456&quot;</span>))<span class="comment">//配置client_secret</span></span><br><span class="line">              .accessTokenValiditySeconds(<span class="number">7200</span>)<span class="comment">//配置访问token的有效期</span></span><br><span class="line">              .refreshTokenValiditySeconds(<span class="number">25600</span>)<span class="comment">//配置刷新token的有效期</span></span><br><span class="line">              .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">              .scopes(<span class="string">&quot;all&quot;</span>)<span class="comment">//配置申请的权限范围</span></span><br><span class="line">              .autoApprove(<span class="keyword">true</span>)  <span class="comment">//自动批准</span></span><br><span class="line">              .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;refresh_token&quot;</span>);<span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="测试可得："><a href="#测试可得：" class="headerlink" title="测试可得："></a>测试可得：</h3><p><img src="/2021/06/01/aouth2-pass/img_20210601213806.png"></p><h3 id="多一个-refresh-token-的参数"><a href="#多一个-refresh-token-的参数" class="headerlink" title="多一个 refresh_token 的参数"></a>多一个 refresh_token 的参数</h3><h4 id="至于-通过-refresh-token-可以刷新-access-token-之前的-access-token-会失效的写法，我会在下一篇中更新："><a href="#至于-通过-refresh-token-可以刷新-access-token-之前的-access-token-会失效的写法，我会在下一篇中更新：" class="headerlink" title="至于 通过 refresh_token 可以刷新 access_token 之前的 access_token 会失效的写法，我会在下一篇中更新："></a>至于 <strong>通过 refresh_token 可以刷新 access_token 之前的 access_token 会失效</strong>的写法，我会在下一篇中更新：</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前一章中我门介绍了-oauth2-的授权的码的登录模式，现在我们来介绍一下-（密码模式）&quot;&gt;&lt;a href=&quot;#1-前一章中我门介绍了-oauth2-的授权的码的登录模式，现在我们来介绍一下-（密码模式）&quot; class=&quot;headerlink&quot; title=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring Cloud Security 结合 oauth2的基本使用方法</title>
    <link href="http://example.com/2021/05/31/oauth2/"/>
    <id>http://example.com/2021/05/31/oauth2/</id>
    <published>2021-05-31T15:09:16.902Z</published>
    <updated>2021-08-14T07:09:56.112Z</updated>
    
    <content type="html"><![CDATA[<h3 id="oauth2的简介"><a href="#oauth2的简介" class="headerlink" title="oauth2的简介"></a>oauth2的简介</h3><h4 id="简介-：OAuth-2-0是用于授权的行业标准协议。OAuth-2-0为简化客户端开发提供了特定的授权流，包括Web应用、桌面应用、移动端应用等。"><a href="#简介-：OAuth-2-0是用于授权的行业标准协议。OAuth-2-0为简化客户端开发提供了特定的授权流，包括Web应用、桌面应用、移动端应用等。" class="headerlink" title="简介 ：OAuth 2.0是用于授权的行业标准协议。OAuth 2.0为简化客户端开发提供了特定的授权流，包括Web应用、桌面应用、移动端应用等。"></a>简介 ：OAuth 2.0是用于授权的行业标准协议。OAuth 2.0为简化客户端开发提供了特定的授权流，包括Web应用、桌面应用、移动端应用等。</h4><h4 id="OAuth-2-0中的四种模式-：授权码模式-简化模式-密码模式-客户端模式"><a href="#OAuth-2-0中的四种模式-：授权码模式-简化模式-密码模式-客户端模式" class="headerlink" title="OAuth 2.0中的四种模式 ：授权码模式  简化模式  密码模式  客户端模式"></a>OAuth 2.0中的四种模式 ：授权码模式  简化模式  密码模式  客户端模式</h4><h3 id="开启案例-："><a href="#开启案例-：" class="headerlink" title="开启案例 ："></a>开启案例 ：</h3><h4 id="我们采取的是springboot-的工程的搭建-（授权码模式）："><a href="#我们采取的是springboot-的工程的搭建-（授权码模式）：" class="headerlink" title="我们采取的是springboot 的工程的搭建 （授权码模式）："></a>我们采取的是springboot 的工程的搭建 （授权码模式）：</h4><h4 id="1-选择我们需要的模块"><a href="#1-选择我们需要的模块" class="headerlink" title="1.选择我们需要的模块"></a>1.选择我们需要的模块</h4><h5 id><a href="#" class="headerlink" title></a><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531211551.png"></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">&lt;/dependency</span><br></pre></td></tr></table></figure><h4 id="2-配置application-yml"><a href="#2-配置application-yml" class="headerlink" title="2.配置application.yml"></a>2.配置application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br></pre></td></tr></table></figure><h4 id="3-首先我们配置SecurityConfig"><a href="#3-首先我们配置SecurityConfig" class="headerlink" title="3.首先我们配置SecurityConfig"></a>3.首先我们配置SecurityConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于对用户名字的密码加密</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf()</span><br><span class="line">                .disable()    <span class="comment">//关闭csrf</span></span><br><span class="line">                .authorizeRequests()  <span class="comment">//开启认证</span></span><br><span class="line">                .anyRequest()     <span class="comment">//任何请求</span></span><br><span class="line">                .authenticated()    <span class="comment">//任何请求都需要认证才可以访问</span></span><br><span class="line">                .and()             </span><br><span class="line">                .formLogin()        <span class="comment">//允许表单登录</span></span><br><span class="line">                .permitAll();        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        auth.inMemoryAuthentication()    <span class="comment">//用来存用户名，这里是基本内存的存法  </span></span><br><span class="line">                .withUser(<span class="string">&quot;admin&quot;</span>)    <span class="comment">//用户名</span></span><br><span class="line">                .password( <span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>)) <span class="comment">//密码</span></span><br><span class="line">                .roles(<span class="string">&quot;user&quot;</span>)   <span class="comment">//角色</span></span><br><span class="line">                .and()           <span class="comment">//配置多个</span></span><br><span class="line">                .withUser(<span class="string">&quot;guo&quot;</span>)   </span><br><span class="line">                .password( <span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>))</span><br><span class="line">                .roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h4 id="4配置-授权服务器"><a href="#4配置-授权服务器" class="headerlink" title="4配置 授权服务器"></a>4配置 <strong>授权服务器</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAuthorizationServer</span>   <span class="comment">//开启资源认证</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        clients.inMemory()   <span class="comment">//基于内存</span></span><br><span class="line">                .withClient(<span class="string">&quot;gsy&quot;</span>)<span class="comment">//配置client_id</span></span><br><span class="line">                .secret(passwordEncoder.encode(<span class="string">&quot;gsy123456&quot;</span>))<span class="comment">//配置client_secret</span></span><br><span class="line">                .accessTokenValiditySeconds(<span class="number">7200</span>)<span class="comment">//配置访问token的有效期</span></span><br><span class="line">                .refreshTokenValiditySeconds(<span class="number">25600</span>)<span class="comment">//配置刷新token的有效期</span></span><br><span class="line">                .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">                .scopes(<span class="string">&quot;all&quot;</span>)<span class="comment">//配置申请的权限范围</span></span><br><span class="line">                .autoApprove(<span class="keyword">true</span>)  <span class="comment">//自动批准</span></span><br><span class="line">                .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>);<span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4配置-资源服务器"><a href="#4配置-资源服务器" class="headerlink" title="4配置 资源服务器"></a>4配置 资源服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableResourceServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceServerConfig</span> <span class="keyword">extends</span> <span class="title">ResourceServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        http.authorizeRequests()  </span><br><span class="line">                .anyRequest()     </span><br><span class="line">                .authenticated()    </span><br><span class="line">                .and()</span><br><span class="line">                .requestMatchers()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/**&quot;</span>).and();<span class="comment">//配置需要保护的资源路径</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5配置-测试controller"><a href="#5配置-测试controller" class="headerlink" title="5配置 测试controller"></a>5配置 测试controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/getCurrentUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello1</span><span class="params">(String code, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="string">&quot;asdaqsdad&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-开启测试-（开启项目）"><a href="#6-开启测试-（开启项目）" class="headerlink" title="6 开启测试   （开启项目）"></a>6 开启测试   （开启项目）</h4><p>首先在浏览器上进行访问  ：<a href="http://localhost:9001/oauth/authorize?response_type=code&amp;client_id=gsy&amp;redirect_uri=http://www.baidu.com&amp;scope=all&amp;state=normal">http://localhost:9001/oauth/authorize?response_type=code&amp;client_id=gsy&amp;redirect_uri=http://www.baidu.com&amp;scope=all&amp;state=normal</a></p><p>分析 ：</p><p><a href="http://localhost:9001/oauth/authorize">http://localhost:9001/oauth/authorize</a>   地址固定</p><p>response_type=code  表示授权码模式 </p><p>client_id，  redirect_uri 的参数   要和  <strong>授权服务器</strong>中的配置的要一样</p><p>访问地址得到 ：</p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531221649.png"></p><p>用户名 /密码为 SecurityConfig配置的 admin/123 或者  guo/123  点击提交，会跳转到百度 <strong>redirect_uri</strong>参数控制的。</p><h4 id="-1"><a href="#-1" class="headerlink" title></a><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531220719.png"></h4><p>获取code 然后 通过 postman工具 来获取  access_token</p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531221010.png"></p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531221058.png"></p><p>使用basic认证  填写上  <strong>授权服务器</strong>里面定位用户与密码</p><p>然后使用post 请求  添加一下参数  code参数为浏览器中获取得  code只可以用一次 ，点击请求 </p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531222008.png"></p><p>获取到  access_token  就可以去访问  测试controller</p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531222227.png"></p><p>配置 access_token  参数 访问  </p><p><img src="/2021/05/31/oauth2/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210531222434.png"></p><p>不配置会报错 </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;error_description&quot;</span>: <span class="string">&quot;Full authentication is required to access this resource&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-至此一个简单的oauth2的测试已经结束-，下一章更新-第二种模式-（密码模式）认证，已经-refresh-token-的作用"><a href="#7-至此一个简单的oauth2的测试已经结束-，下一章更新-第二种模式-（密码模式）认证，已经-refresh-token-的作用" class="headerlink" title="7.至此一个简单的oauth2的测试已经结束 ，下一章更新  第二种模式 （密码模式）认证，已经  refresh_token 的作用"></a>7.至此一个简单的oauth2的测试已经结束 ，下一章更新  第二种模式 （密码模式）认证，已经  refresh_token 的作用</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;oauth2的简介&quot;&gt;&lt;a href=&quot;#oauth2的简介&quot; class=&quot;headerlink&quot; title=&quot;oauth2的简介&quot;&gt;&lt;/a&gt;oauth2的简介&lt;/h3&gt;&lt;h4 id=&quot;简介-：OAuth-2-0是用于授权的行业标准协议。OAuth-2-0为简</summary>
      
    
    
    
    
  </entry>
  
</feed>
